!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.rbac=r():e.rbac=r()}(self,(function(){return(()=>{"use strict";var e={};return(()=>{var r=e;Object.defineProperty(r,"__esModule",{value:!0}),r.RBAC=void 0;var t=function(){function e(e){this.users={},this.roles={},this.debug=void 0!==e.debug&&e.debug,this.roles=e.rolesConfig.reduce((function(e,r){for(var t=0,s=r.roles;t<s.length;t++)e[s[t]]=r.permissions;return e}),{})}return e.prototype.getUserRoles=function(e){return e?this.users[e]?this.users[e]:this.generateError(e+" userId is not defined, please add a user to the RBAC using addUserRoles method"):this.generateError("userId is not defined, expected 1 arguments")},e.prototype.addUserRoles=function(e,r){if(!e||!r)return this.generateError("userId or roles is not defined, expected 2 arguments");if(0===r.length)return this.generateError("roles length is 0, expected at least 1");for(var t=0,s=r;t<s.length;t++){var n=s[t];if(!this.roles[n])return this.generateError(n+" role is not defined in initial config");this.users[e]?this.users[e].includes(n)||this.users[e].push(n):this.users[e]=[n]}},e.prototype.removeUserRoles=function(e,r){if(!e)return this.generateError("userId is not defined, expected 1 arguments");if(!this.users[e])return this.generateError(e+" userId is not defined, please add a user to the RBAC using addUserRoles method");if(r)for(var t=0,s=r;t<s.length;t++){var n=s[t],i=this.users[e].indexOf(n);i+1&&this.users[e].splice(i,1)}else delete this.users[e]},e.prototype.isAllowed=function(e,r){var t=this;if(!e||!r)return this.generateError("userId or permissionId is not defined, expected 2 arguments");var s=this.users[e];return s?s.some((function(e){return t.roles[e].includes(r)})):this.generateError(e+" userId is nor defined, please add user to the RBAC using addUserRoles method")},e.prototype.extendRole=function(e,r){if(!e||!r)return this.generateError("role or extendingRoles is not defined, expected 2 arguments");if(0===r.length)return this.generateError("extendingRoles length is 0, expected at least 1");if(!this.roles[e])return this.generateError(e+" role is not defined in the initial config");for(var t=0,s=r;t<s.length;t++){var n=s[t];if(!this.roles[n])return this.generateError(e+" role is not defined in the initial config");this.roles[e]=this.roles[e].concat(this.roles[n])}},e.prototype.middleware=function(e,r,t){if(!e||!r||!t)return r(),this.generateError("one of the incoming parameters is not defined, expected 3 arguments");this.isAllowed(e.userId,e.permissionId)?t():r()},e.prototype.generateError=function(e){return this.debug&&console.warn(e),new Error(e)},e}();r.RBAC=t,r.default=t})(),e})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dUVBRzFCVCxLQUFLbUIsVUFBVVUsRUFBT3JCLE9BQVFxQixFQUFPVCxjQUNyQ1csSUFFQUQsS0FJQSxZQUFBckIsY0FBUixTQUFzQnVCLEdBSWxCLE9BSEloQyxLQUFLQyxPQUNMZ0MsUUFBUUMsS0FBS0YsR0FFVixJQUFJRyxNQUFNSCxJQUV6QixFQXRJQSxHQUFhLEVBQUFJLEtBQUFBLEVBd0liLFVBQWVBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYmFjL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9yYmFjLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInJiYWNcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wicmJhY1wiXSA9IGZhY3RvcnkoKTtcbn0pKHNlbGYsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsImludGVyZmFjZSBJVXNlcnMge1xuICAgIFt1c2VySWQ6IHN0cmluZ106IHN0cmluZ1tdXG59XG5cbmludGVyZmFjZSBJUm9sZXMge1xuICAgIFtwZXJtaXNzaW9uSWQ6IHN0cmluZ106IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElSb2xlc0NvbmZpZyB7XG4gICAgcm9sZXM6IHN0cmluZ1tdLFxuICAgIHBlcm1pc3Npb25zOiBzdHJpbmdbXVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElNaWRkbGV3YXJlIHtcbiAgICAocGFyYW1zOiB7IHVzZXJJZDogc3RyaW5nOyBwZXJtaXNzaW9uSWQ6IHN0cmluZzsgfSwgZXJyb3I6ICgpID0+IHZvaWQsIHN1Y2Nlc3M6ICgpID0+IHZvaWQpOiB2b2lkIHwgRXJyb3I7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJCQUMge1xuICAgIGdldFVzZXJSb2xlczogKHVzZXJJZDogc3RyaW5nKSA9PiBzdHJpbmdbXSB8IEVycm9yO1xuICAgIHJlbW92ZVVzZXJSb2xlczogKHVzZXJJZDogc3RyaW5nLCByb2xlPzogc3RyaW5nW10pID0+IHZvaWQgfCBFcnJvcjtcbiAgICBhZGRVc2VyUm9sZXM6ICh1c2VySWQ6IHN0cmluZywgcm9sZTogc3RyaW5nW10pID0+IHZvaWQgfCBFcnJvcjtcbiAgICBpc0FsbG93ZWQ6ICh1c2VySWQ6IHN0cmluZywgcGVybWlzc2lvbklkOiBzdHJpbmcpID0+IGJvb2xlYW4gfCBFcnJvcjtcbiAgICBleHRlbmRSb2xlOiAocm9sZTogc3RyaW5nLCBleHRlbmRpbmdSb2xlczogc3RyaW5nW10pID0+IHZvaWQgfCBFcnJvcjtcbiAgICBtaWRkbGV3YXJlOiBJTWlkZGxld2FyZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29uZmlnIHtcbiAgICByb2xlc0NvbmZpZzogSVJvbGVzQ29uZmlnW107XG4gICAgZGVidWc/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgUkJBQyBpbXBsZW1lbnRzIElSQkFDIHtcbiAgICBwcml2YXRlIHVzZXJzOiBJVXNlcnMgPSB7fTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRlYnVnOiBib29sZWFuO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgcm9sZXM6IElSb2xlcyA9IHt9O1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnOiBJQ29uZmlnKSB7XG4gICAgICAgIHRoaXMuZGVidWcgPSAodHlwZW9mIGNvbmZpZy5kZWJ1ZyAhPT0gJ3VuZGVmaW5lZCcpID8gY29uZmlnLmRlYnVnIDogZmFsc2U7XG5cbiAgICAgICAgdGhpcy5yb2xlcyA9IGNvbmZpZy5yb2xlc0NvbmZpZy5yZWR1Y2UoXG4gICAgICAgICAgICAoYWNjdW11bGF0b3I6IElSb2xlcywgaXRlbTogSVJvbGVzQ29uZmlnKTogSVJvbGVzID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCByb2xlIG9mIGl0ZW0ucm9sZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3Jbcm9sZV0gPSBpdGVtLnBlcm1pc3Npb25zO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge31cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VXNlclJvbGVzKHVzZXJJZDogc3RyaW5nKTogc3RyaW5nW10gfCBFcnJvciB7XG4gICAgICAgIGlmICghdXNlcklkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKCd1c2VySWQgaXMgbm90IGRlZmluZWQsIGV4cGVjdGVkIDEgYXJndW1lbnRzJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy51c2Vyc1t1c2VySWRdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy51c2Vyc1t1c2VySWRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFcnJvcih1c2VySWQgKyAnIHVzZXJJZCBpcyBub3QgZGVmaW5lZCwgcGxlYXNlIGFkZCBhIHVzZXIgdG8gdGhlIFJCQUMgdXNpbmcgYWRkVXNlclJvbGVzIG1ldGhvZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFkZFVzZXJSb2xlcyh1c2VySWQ6IHN0cmluZywgcm9sZXM6IHN0cmluZ1tdKTogdm9pZCB8IEVycm9yIHtcbiAgICAgICAgaWYgKCF1c2VySWQgfHwgIXJvbGVzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKCd1c2VySWQgb3Igcm9sZXMgaXMgbm90IGRlZmluZWQsIGV4cGVjdGVkIDIgYXJndW1lbnRzJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocm9sZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKCdyb2xlcyBsZW5ndGggaXMgMCwgZXhwZWN0ZWQgYXQgbGVhc3QgMScpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgcm9sZSBvZiByb2xlcykge1xuICAgICAgICAgICAgaWYgKHRoaXMucm9sZXNbcm9sZV0pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy51c2Vyc1t1c2VySWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy51c2Vyc1t1c2VySWRdLmluY2x1ZGVzKHJvbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJzW3VzZXJJZF0ucHVzaChyb2xlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcnNbdXNlcklkXSA9IFtyb2xlXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3Iocm9sZSArICcgcm9sZSBpcyBub3QgZGVmaW5lZCBpbiBpbml0aWFsIGNvbmZpZycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgcmVtb3ZlVXNlclJvbGVzKHVzZXJJZDogc3RyaW5nLCByb2xlcz86IHN0cmluZ1tdKTogdm9pZCB8IEVycm9yIHtcbiAgICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3IoJ3VzZXJJZCBpcyBub3QgZGVmaW5lZCwgZXhwZWN0ZWQgMSBhcmd1bWVudHMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnVzZXJzW3VzZXJJZF0pIHtcbiAgICAgICAgICAgIGlmICghcm9sZXMpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy51c2Vyc1t1c2VySWRdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCByb2xlIG9mIHJvbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvbGVJbmRleCA9IHRoaXMudXNlcnNbdXNlcklkXS5pbmRleE9mKHJvbGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb2xlSW5kZXggKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJzW3VzZXJJZF0uc3BsaWNlKHJvbGVJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKHVzZXJJZCArICcgdXNlcklkIGlzIG5vdCBkZWZpbmVkLCBwbGVhc2UgYWRkIGEgdXNlciB0byB0aGUgUkJBQyB1c2luZyBhZGRVc2VyUm9sZXMgbWV0aG9kJyk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBpc0FsbG93ZWQodXNlcklkOiBzdHJpbmcsIHBlcm1pc3Npb25JZDogc3RyaW5nKTogYm9vbGVhbiB8IEVycm9yIHtcbiAgICAgICAgaWYgKCF1c2VySWQgfHwgIXBlcm1pc3Npb25JZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFcnJvcigndXNlcklkIG9yIHBlcm1pc3Npb25JZCBpcyBub3QgZGVmaW5lZCwgZXhwZWN0ZWQgMiBhcmd1bWVudHMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVzZXIgPSB0aGlzLnVzZXJzW3VzZXJJZF07XG5cbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB1c2VyLnNvbWUodXNlclJvbGUgPT4gdGhpcy5yb2xlc1t1c2VyUm9sZV0uaW5jbHVkZXMocGVybWlzc2lvbklkKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKHVzZXJJZCArICcgdXNlcklkIGlzIG5vciBkZWZpbmVkLCBwbGVhc2UgYWRkIHVzZXIgdG8gdGhlIFJCQUMgdXNpbmcgYWRkVXNlclJvbGVzIG1ldGhvZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGV4dGVuZFJvbGUocm9sZTogc3RyaW5nLCBleHRlbmRpbmdSb2xlczogc3RyaW5nW10pOiB2b2lkIHwgRXJyb3Ige1xuICAgICAgICBpZiAoIXJvbGUgfHwgIWV4dGVuZGluZ1JvbGVzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKCdyb2xlIG9yIGV4dGVuZGluZ1JvbGVzIGlzIG5vdCBkZWZpbmVkLCBleHBlY3RlZCAyIGFyZ3VtZW50cycpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV4dGVuZGluZ1JvbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFcnJvcignZXh0ZW5kaW5nUm9sZXMgbGVuZ3RoIGlzIDAsIGV4cGVjdGVkIGF0IGxlYXN0IDEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnJvbGVzW3JvbGVdKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBleHRlbmRpbmdSb2xlIG9mIGV4dGVuZGluZ1JvbGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucm9sZXNbZXh0ZW5kaW5nUm9sZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb2xlc1tyb2xlXSA9IHRoaXMucm9sZXNbcm9sZV0uY29uY2F0KHRoaXMucm9sZXNbZXh0ZW5kaW5nUm9sZV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3Iocm9sZSArICcgcm9sZSBpcyBub3QgZGVmaW5lZCBpbiB0aGUgaW5pdGlhbCBjb25maWcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUVycm9yKHJvbGUgKyAnIHJvbGUgaXMgbm90IGRlZmluZWQgaW4gdGhlIGluaXRpYWwgY29uZmlnJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgbWlkZGxld2FyZShwYXJhbXM6IHsgdXNlcklkOiBzdHJpbmc7IHBlcm1pc3Npb25JZDogc3RyaW5nOyB9LCBlcnJvcjogKCkgPT4gdm9pZCwgc3VjY2VzczogKCkgPT4gdm9pZCk6IHZvaWQgfCBFcnJvciB7XG4gICAgICAgIGlmICghcGFyYW1zIHx8ICFlcnJvciB8fCAhc3VjY2Vzcykge1xuICAgICAgICAgICAgZXJyb3IoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRXJyb3IoJ29uZSBvZiB0aGUgaW5jb21pbmcgcGFyYW1ldGVycyBpcyBub3QgZGVmaW5lZCwgZXhwZWN0ZWQgMyBhcmd1bWVudHMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzQWxsb3dlZChwYXJhbXMudXNlcklkLCBwYXJhbXMucGVybWlzc2lvbklkKSkge1xuICAgICAgICAgICAgc3VjY2VzcygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2VuZXJhdGVFcnJvcihtZXNzYWdlOiBhbnkpOiBFcnJvciB7XG4gICAgICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJCQUM7XG4iXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwic2VsZiIsImNvbmZpZyIsInVzZXJzIiwicm9sZXMiLCJ0aGlzIiwiZGVidWciLCJyb2xlc0NvbmZpZyIsInJlZHVjZSIsImFjY3VtdWxhdG9yIiwiaXRlbSIsInBlcm1pc3Npb25zIiwiZ2V0VXNlclJvbGVzIiwidXNlcklkIiwiZ2VuZXJhdGVFcnJvciIsImFkZFVzZXJSb2xlcyIsImxlbmd0aCIsInJvbGUiLCJpbmNsdWRlcyIsInB1c2giLCJyZW1vdmVVc2VyUm9sZXMiLCJyb2xlSW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwiaXNBbGxvd2VkIiwicGVybWlzc2lvbklkIiwidXNlciIsInNvbWUiLCJ1c2VyUm9sZSIsImV4dGVuZFJvbGUiLCJleHRlbmRpbmdSb2xlcyIsImV4dGVuZGluZ1JvbGUiLCJjb25jYXQiLCJtaWRkbGV3YXJlIiwicGFyYW1zIiwiZXJyb3IiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNvbnNvbGUiLCJ3YXJuIiwiRXJyb3IiLCJSQkFDIl0sInNvdXJjZVJvb3QiOiIifQ==